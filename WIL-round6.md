# WIL - 6주차 (Failure-Ready Systems)

## 🧠 이번 주에 새로 배운 것
- Circuit Breaker
- Timeout & Retry
- Fallback 처리
- 외부 시스템 연동

## 💭 이런 고민이 있었어요
1. Circuit Breaker와 retry 위치
- 처음에는 PaymentService의 카드 결제 요청 메소드에 Circuit breaker와 retry를 설정함
- 하지만 pg API 호출 이외의 DB 트랜잭션은 재시도할 필요가 없다고 판단함
- Circuit Breaker와 retry 위치를 pgClient로 변경함
2. Fallback 처리
- pg API 호출 리트라이까지 실패했을 경우, PENDING 상태로 두고 조치를 취할 것인지 고민됨
- 결제 실패 상태이긴 한데 FAIL 처리를 해야 하는지 고민이 되었음
- 리팩토링 필요한 부분
3. 결제 요청 실패 시 처리
- 결제 요청 실패 시 fallback 메소드에서 처리했는데 이 부분이 잘못된 것인지 고민이 됨
- 어떤 위치에서 처리해야 하는지 .. circuit breaker가 동작해서 실패한 것인지 이유가 뭔지 영속화 필요한지?
4. pg한테 콜백도 안 올 경우
- 책임의 소재가 우리 시스템이 아니라 pg사에 있으므로 어디까지 대응을 해야 하는지 실무적인 고민

## 💡 앞으로 실무에 써먹을 수 있을 것 같은 포인트
- 외부 시스템 연동 시 내가 제어할 수 없는 부분에서 문제가 일어나는 경우가 종종 있는데 서킷 브레이커를 적용해 보면 좋을 것 같다.
- 외부 시스템 연동 실패 시 같은 트랜잭션에 있는 작업들이 rollback될 수 있기 때문에 그 부분을 주의해서 시스템 리팩토링을 하면 좋을 것 같다.

## 🤔 아쉬웠던 점 & 다음 주에 해보고 싶은 것
- 결제 요청 실패 시 order/payment에 상태에 대한 핸들링 부분이 미흡했다.
- 시간 부족으로 급하게 과제를 하느라 .. Payment 객체 영속화 부분을 빼먹어버림..리팩토링 빠르게 하기
